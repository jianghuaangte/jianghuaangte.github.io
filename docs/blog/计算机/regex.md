---
title: Vim 正则表达式
tags:
  - vim
  - 正则
createTime: 2025/11/01 20:29:52
permalink: /blog/ejwyatq2/
---

## Vim 正则

- VI/Vim (Neovim) 使用的正则引擎既不是NFA也不是DFA而属于 BRE 流派
- 适用 VI

## 比较 Vim 和 Perl 中的正则

## 注意
这里的所有 `Vim` 相关选项作为对比项是指加了\  v 魔术的值，并默认开启了：
- -g 全局匹配
- -m 多行模式
## 元字符
基本跟 Perl 一样

| 符号   | 名称  |说明|
| ---- | --- | ------------------------------ |
| `.`  | 点号  | 匹配除换行符以外的任意单个字符（除非设置 `/s` 修饰符） |
| `^`  | 脱字符 | 匹配行首（多行模式下匹配每行开头）              |
| `$`  | 美元符 | 匹配行尾（多行模式下匹配每行结尾）              |
| `*`  | 星号  | 前一个原子重复 0 次或多次                 |
| `+`  | 加号  | 前一个原子重复 1 次或多次                 |
| `?`  | 问号  | 前一个原子重复 0 次或 1 次；或用于构成懒惰量词     |
| `{}` | 花括号 | 限定次数 `{m,n}`、`{m,}`、`{m}`      |
| `[]` | 方括号 | 字符类，用于匹配集合中的任意一个字符             |
| `()` | 圆括号 | 捕获分组（子表达式）                     |
| `\|`    |竖线                             | 多选结构（“或”） |
| `\`  | 反斜杠 | 转义字符，使元字符失效或引入特殊转义序列           |


## 字符组
正则加`\v` 基本上跟 `Perl/PCRE`差不多

## 量词

### 匹配优先

| Perl1 | Vim      | vim独占                      | 说明       |
| :---- | :------- | -------------------------- | -------- |
| \\*    | \\*       | {} 等价于\*                 | 0或多，尽可能多 |
| +     | +        |                            | 1或多，尽可能多 |
| ?     | ?        | 和 \= 一样。不能和反向查找的 "?" 命令中使用 | 0或1，尽可能多 |
| \{n,\}  | \{n,\}     |                            | 至少n，尽可能多 |
| \{,m\}  | \{,m\}     |                            | 0至m，尽可能多 |
| \{n\}   | \{n\} 或 \{-n\} |                            | 固定重复     |

### 忽略优先
`-` 代表`少`的意思，负的`意思`

| Perl/PCRE | Vim        | 说明            |
| --------- | :--------- | ------------- |
| \*?       | \{-\}        | 0或多，尽可能少 |
| +?        | \{-1\} 或 \{-1,\} | 1或多，尽可能少 |
| ??        | \{-,1\}      | 0或1，尽可能少   |
| \{n,}?     | \{-n,\}      | 至少n，尽可能少      |
| \{n,m}?    | \{-n,m\}     | n至m，尽可能少      |
| \{n}       | \{n\} 或 \{-n\}   | 固定次数          |

## 括号

| Perl    | Vim    | 说明     |
| :------ | ------ | ------ |
| (...)   | (...)  | 分组、捕获组 |
| (?:...) | %(...) | 非捕获组   |

## 锚点
| Perl | Vim  | 说明                   |
| :--- | ---- | -------------------- |
| ^    | ^    | 行首，(Vim 默认启用了-m多行模式) |
| $    | $    | 行尾，(Vim 默认启用了-m多行模式) |
| %^   | \A   | 段落首                  |
| %$   | `\Z` | 段落尾                  |

## 断言
### 单词边界

| Perl | Vim       |
| :--- | --------- |
| \b   | `<` 和 `>` |


### 环视
| 环视类型       | Vim 语法 | 形式      | 含义（模式指括号里内容）        | 等价于 PCRE   |
| ---------- | ------ | ------- | ------------------- | ---------- |
| **肯定顺序环视** | `@=`   | a(b)@=  | 匹配一个位置，**后面**是某个模式  | `(?=...)`  |
| **否定顺序环视** | `@!`   | a(b)@!  | 匹配一个位置，**后面不是**某个模式 | `(?!...)`  |
| **肯定逆序环视** | `@<=`  | (b)@<=a | 匹配一个位置，**前面**是某个模式  | `(?<=...)` |
| **否定逆序环视** | `@<!`  | (b)@\<!a | 匹配一个位置，**前面不是**某个模式 | `(?<!...)` |

注意：
- Vim 环视中使用的表达式写在环视的左方并加上括号
	- 如 a(b)@!，匹配a后面不是b的位置
- 可以这样记忆：环视位置只位于`)`闭括号右侧，而(b)和a谁在前谁在后是相对的
	- 匹配一个a前面不跟着(b) 在`)`加上语法,先写 a 再在前面写上 b 加上换作，最后在括号)右侧添加环视语法


## 修饰符
有两种，一种是写在替换表达式后面的，另一种是写在正则内部的。
### 模式修饰符
| Perl   | Vim                             |
| :----- | ------------------------------- |
| s 单行模式 | \\\_.                            |
| m 多行模式 | 默认启用了-m ，也就是改变了 `^` 和 `$` 的锚点位置 |

- 以上两个模式在`替换`中不支持写在正则后面，也就是说只能写在正则里

### 内联修饰符
| Perl  | Vim      |
| :---- | -------- |
| (?i)  | \c 忽略大小写 |
| (?-i) | \C 区分大小写 |

## 参考
- [Vim 官方文档](https://yianwillis.github.io/vimcdoc/doc/pattern.html#pattern.txt)
- [Perl 正则](perl-regex.md)
- 《正则指引》第二版18章内容
