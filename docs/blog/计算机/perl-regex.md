---
title: Perl/PCRE 正则表达式
tags:
  - 正则
  - Perl
createTime: 2025/11/01 20:59:57
permalink: /blog/w83pj83d/
---

## 正则工具
- [正则工具(推荐)](https://regex101.com/)
- [在线正则可视化工具](https://c.runoob.com/front-end/854/?optionGlobl=global)
- [EmEdit 正则语法](https://www.emeditor.org/zh-cn/howto/search/search_regexp_syntax.html)

## 写正则的思考思路
- 必须出现
- 可能出现
- 不可能出现

## Vim 正则比较
请阅读：[Vim 正则表达式](regex.md)


## 正则引擎
**主要有三类：**
- 传统型 NFA （主流）
- POSIX  NFA  （GNU工具）
- DFA

这里以传统型 NFA  为主要内容。


## 正则匹配过程

可以把待匹配的`字符串` 想象它流水线上的产品，正则表达式相当于流水线上的挑选工人。
这里是 Perl 语法为例

![process](/images/process.jpg)



## 正则术语表

| 名称     | 别名                | 子集  |
| :----- | :---------------- | --- |
| 零宽断言   | 断言/预搜索/环视/环顾/匹配边界 |     |
| 匹配优先   | 贪婪模式、             |     |
| 忽略优先匹配 | 非贪婪模式/懒惰模式        |     |
| 量词     | 重复/               |     |
| 字符集    | 字符类/字符组           |     |


## 编辑器的默认值
很多正则编辑器如 “emeditor”、"cotEditor" 因为设计目录都是为以行为单位的文本服务的，所以很多都是默认开启以下修饰符：
- -g 全局匹配
- -m 多行模式


---

::: center
**正则主体内容：↓**
:::


## 普通字符
即没有特殊意义的字符


| 字符          | 说明          |
| :---------- | :---------- |
| 26 个字母（含大写） | 普通字符按字面匹配   |
| 中文符号和标点     | 全是普通字符      |
| 数字          |             |
| ~           | 波浪行         |
| ~           | 在排除型字符内外不同  |
| \`          | 反引号         |
| @           |             |
| \#          |             |
| %           |             |
| &           |             |
| -           | 如 a-z       |
| _           | 下划线         |
| =           |             |
| \]          |             |
| \;          | 分号          |
| \:          | 冒号          |
| \"          | 双引号         |
| \'          | 单引号         |
| <           |             |
| >           |             |
| /           | 部分正则会以“/”分隔 |


括号转义

| 的          | 的           |
| :--------- | :---------- |
| （          |             |
| )          |             |
| \\()       | 无效，必须双括号都转义 |
| \\(\\)     |             |
|            |             |
| \[         |             |
| \]         |             |
| \\[]       | 有效，但不用这个    |
| \\[\...\\] | 有效，最好用这个写法  |
| \\{        | 可加可不加       |
| \\}        | 可加可不加       |
| \\{...}    | 支持，但不推荐     |
| \\{....\\} | 推荐写法        |


所有字符都是文字除了: ".", "\*", "?", "+", "(", ")", "{", "}", "\[", "\]", "^", "$" 和 "\\"。这些字符代表文字当之前有一个 "\\" 时。一个文字是一个与它自己相匹配的字符。例如，搜索 "\\?" 会匹配每一个在文档中的 "?" ，或搜索 "Hello" 会匹配每一个在文档中的 "Hello" 。

## 元字符
即有特殊意义的字符

| 元字符            | 符号  | 说明                                                                                                                                                                                                                                                                                                                                                                  |
| :------------- | --- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| \\             | 把下一个字符标记为一个特殊字符，一个文字，或一个向后引用。例如，'n' 与字符 "n" 相匹配。而 '\\n' 代表一个换行符号。序列 '\\\\' 代表 "\\"，"\\(" 则与 "(" 相匹配。                                                                                                                                                                                                                                                                |
| ^              | 匹配输入字符串的开始位置。例如，"^e" 表示任何由 "e" 开头的字符串。                                                                                                                                                                                                                                                                                                                              |
| $              | 匹配输入字符串的结尾位置。例如，"e$" 表示任何由 "e" 结尾的字符串。                                                                                                                                                                                                                                                                                                                              |
| \*             | 匹配之前的字符或子表达式零次或多次。例如，zo\* 会匹配 "z" 以及 "zoo"。\* 等同于 {0,}。                                                                                                                                                                                                                                                                                                             |
| +              | 匹配之前的字符或子表达式一次或多次。例如，'zo+' 匹配 "zo" 以及 "zoo"，但不匹配 "z"。 + 等同于 {1,}。                                                                                                                                                                                                                                                                                                   |
| ?              | 匹配之前的字符或子表达式零次或一次。例如，"do(es)?" 匹配 "do" 在  "do" 或 "does" 中。? 等同于 {0,1}。                                                                                                                                                                                                                                                                                              |
| ?              | 当这个字符紧跟着任何其他数量词 (\*, +, ?, {n}, {n,}, {n,m}) 时，匹配的模式是非贪婪。一个非贪婪模式尽可能少地与搜索字符串匹配，而默认的贪婪模式则尽可能多地与搜索字符串匹配。例如，字符串 "oooo"，'o+?' 匹配单一的一个 "o"，而w 'o+' 匹配所有 'o'。                                                                                                                                                                                                              |
| .              | 与任何单一字符串匹配。例如，".e" 匹配任何在 "e" 之前的文字，如 "he"，"we"，或 "me"。<br><br>在 EmEditor Professional 中，它匹配 **搜索正则表达式的附近行** 文本框中指定范围内的换行当 **正则表达式 "." 匹配换行符** 复选框被勾选。                                                                                                                                                                                                               |
## 字符组
- **也叫“字符集”**

|形式|说明|
|:---|:---|
| \[xyz\]<br>    |字符集。匹配任何在括号内的字符。例如，'\[abc\]' 与 "plain" 中的 'a' 相匹配。                                                                                                                                                                                                                                                                                                                  |
| \[^xyz\]<br>   |负字符集。匹配任何不在括号内的字符。例如，\[^abc\]' 与 "plain" 中的 'p' 相匹配。                                                                                                                                                                                                                                                                                                                |
| \[a-z\]        |字符范围。与任何指定范围的字符相匹配。例如，'\[a-z\]' 与任何 'a' 到 'z' 的小写字母相匹配。                                                                                                                                                                                                                                                                                                             |
| \[^a-z\]       |负字符范围。与任何不在指定范围内的字符相匹配。例如，'\[a-z\]' 与任何不在 'a' 到 'z' 范围内的字符相匹配。                                                                                                                                                                                                                                                                                                      |


### 普通字符组
一般使用 Unicode 或 ASICC 编码顺序设置范围，如[a-z]、[0-9]

### 简写字符组

正则表达式提供一些常用的字符集简写。如下:

| 简写  | 描述                                 |
| :-: | ---------------------------------- |
|  .  | 除换行符外的所有字符                         |
| \w  | 匹配所有字母数字，等同于 `[a-zA-Z0-9_]`        |
| \W  | 匹配所有非字母数字，即符号，等同于： `[^\w]`         |
| \d  | 匹配数字： `[0-9]`                      |
| \D  | 匹配非数字： `[^\d]`                     |
| \s  | 匹配所有空格字符，等同于： `[\t\n\f\r\p{Z}]`    |
| \S  | 匹配所有非空格字符： `[^\s]`                 |
| \f  | 匹配一个换页符                            |
| \n  | 匹配一个换行符                            |
| \r  | 匹配一个回车符                            |
| \t  | 匹配一个制表符                            |
| \v  | 匹配一个垂直制表符                          |
| \p  | 匹配 CR/LF（等同于 `\r\n`），用来匹配 DOS 行终止符 |

---

### 字符组的字符位置
**正则表达式里的 `[]`（字符组）中，有些符号在不同位置会有不同的意义**
- 不同位置上的 `-`（连字符）

|写法|含义|
|---|---|
|`[a-z]`|匹配 `a` 到 `z` 之间的任意小写字母（**范围**）|
|`[-az]` 或 `[az-]`|`-` 在**开头或结尾** → 被视为**普通字符 `-`**|
|`[a\-z]`|`\` 转义后表示**字面量 `-`**|
|`[a-z-]`|匹配 `a`~`z` 以及 `-`|
|`[a-b-c]`|通常解析为 `[a-c]`（即 `a` 到 `c`），但在不同实现中可能会被认为是两个范围重叠（不推荐）|

✅ **结论**：  
在字符组中，`-` 只有当它位于两个字符之间（例如 `a-z`）时才表示**范围**；  
位于开头、结尾或被转义时，表示字面字符。

---
- 不同位置上的`^`（脱字符）

| 写法       | 含义                                            |
| -------- | --------------------------------------------- |
| `[^a-z]` | 在**开头**表示**取反（否定）**，匹配除小写字母外的任何`字符`（必须匹配一个字符） |
| `[a^z]`  | 不在开头时表示**字面量 `^`**                            |

✅ **结论**：  
`^` 只有在 `[` 后**紧跟出现**时才有特殊意义（表示**取反**），否则就是普通字符

特别说明：**排除型字符组被排除的位置`必须`占一个字符**  
它无法匹配 `Iraq` 因为`q`后面没有字符

<img src="/images/exclude.jpeg" width="400">

- 不同位置上的 `]`（右方括号）

| 写法      | 含义                                        |
| ------- | ----------------------------------------- |
| `[]]`   | 匹配 `]` 本身（第一个 `]` 结束字符组，第二个是内容）→ 一般匹配 `]` |
| `[a\]]` | 转义后表示字面量 `]`                              |
| `[a]]`  | 一些实现中等价于（或强制转义） `[a\]]`（第二个 `]` 当作普通字符）   |

✅ **结论**：  
`]` 如果出现在**字符组开头**（如 `[]a]` 或 `[a]]`）或**被转义**，就表示普通 `]`。

---
- 不同位置上的 `[` （右中括号）

| 写法        | 含义             |
| --------- | -------------- |
| `[[a-z]]` | 内层的 `[` 被视为字面量 |
| `[\[]`    | 明确转义表示 `[`     |

✅ **结论**：  
`[` 一般只需转义或放在特殊位置（如首位）即可表示字面意义。

---
- 不同位置上的 `\`（反斜杠）

|写法|含义|
|---|---|
|`[a\-z]`|转义后表示 `-`|
|`[\\]`|匹配反斜杠本身|
|`[\\-]`|匹配反斜杠或 `-`|

✅ **结论**：  
`\` 在字符组中通常仍保留转义意义，但**不同语言实现略有差异**。  
（例如 POSIX 中 `[\\]` 匹配 `\`，但某些简化版不支持。）

---



## 量词
- 注意，**量词会创建回溯点**
### 量词分类

| 分类  | 名称         | 特征              | 回溯           | 示例                           |
| --- | ---------- | --------------- | ------------ | ---------------------------- |
| ①   | **贪婪量词**   | **匹配尽可能多**      | ✅ 可回溯        | `.*`                         |
| ②   | **惰性量词**   | **匹配尽可能少**      | ✅ 可回溯        | `.*?`                        |
| ③   | **占有量词**   | **匹配尽可能多，但不回溯** | ❌ 不回溯        | `.*+`                        |
| ④   | **固定次数量词** | 匹配确定次数          | 无需回溯         | `a{3}`                       |
| ⑤   | **区间量词**   | 指定最小 / 最大次数     | ✅（可与惰性/占有结合） | `a{2,5}`、`a{2,5}?`、`a{2,5}+` |

---


### 区间量词
| 语法      | 说明       | 等价形式                 |
| ------- | -------- | -------------------- |
| `{n}`   | 匹配恰好 n 次 | 固定                   |
| `{n,}`  | 至少 n 次   | 类似 `patternpattern*` |
| `{,m}`  | 0 到 m 次  | 旧 Perl 不支持此省略写法      |
| `{n,m}` | n 到 m 次  | 可结合惰性或占有后缀           |


---

### 匹配优先量词
也叫贪婪模式匹配

| 语法      | 名称      | 行为               | 示例         | 匹配策略说明                      |
| ------- | ------- | ---------------- | ---------- | --------------------------- |
| `*`     | 零次或多次   | **尽可能多匹配**，必要时回溯 | `/a*b/`    | 匹配 `aaab` 中的 `aaa`（多 → 少回溯） |
| `+`     | 一次或多次   | **尽可能多匹配**，必要时回溯 | `/a+b/`    | 匹配 `aaab` 中的 `aaa`          |
| `?`     | 零次或一次   | **尽可能多匹配一次**     | `/a?b/`    | 匹配 `ab` 或仅 `b`              |
| `{n}`   | 恰好 n 次  | 固定匹配 n 次，无回溯     | `/a{3}/`   | 匹配 `aaa`                    |
| `{n,}`  | 至少 n 次  | 尽可能多匹配，必要时回溯     | `/a{2,}/`  | 匹配 2 次起                     |
| `{n,m}` | n 到 m 次 | 尽可能多匹配，必要时回溯     | `/a{2,4}/` | 匹配 2~4 个 `a`，优先 4           |

---

### 忽略优先量词
也叫惰性（非贪婪）量词

| 语法       | 含义           | 匹配策略        | 示例匹配 `"aaaa"`      |
| -------- | ------------ | ----------- | ------------------ |
| `*?`     | 尽可能少（0~n）    | 先尝试最少，再回溯增加 | `a*?` → `""`（空匹配）  |
| `+?`     | 尽可能少（1~n）    | 最小满足匹配      | `a+?` → `"a"`      |
| `??`     | 尽可能少（0 或 1）  | 优先匹配 0 次    | `a??` → `""`       |
| `{n,}?`  | 匹配至少 n 次，尽量少 |             | `a{2,}?` → `"aa"`  |
| `{n,m}?` | 匹配 n~m 次，尽量少 |             | `a{2,3}?` → `"aa"` |

🧠 **行为特点**：**先尝试最少可能匹配**，如不满足则回溯扩张

---

### 占有量词
| 语法       | 含义         | 行为         | 回溯  | 示例匹配 `"aaaa"`                |
| -------- | ---------- | ---------- | --- | ---------------------------- |
| `*+`     | 0 到任意多次，占有 | 一次性吃光，绝不回头 | ❌   | `a*+b` 不匹配 `"aaaaab"`（因为不回退） |
| `++`     | 1 到任意多次，占有 | 同上         | ❌   |                              |
| `?+`     | 0 或 1，占有   | 同上         | ❌   |                              |
| `{n,}+`  | 至少 n，占有    | 同上         | ❌   |                              |
| `{n,m}+` | n~m，占有     | 同上         | ❌   |                              |

---

### 量词总结
| 类型  | 写法                 | 匹配策略 | 回溯行为  | 常见用途        |
| --- | ------------------ | ---- | ----- | ----------- |
| 贪婪  | `*`、`+`、`{n,m}`    | 尽量多  | ✅ 可回溯 | 默认模式        |
| 惰性  | `*?`、`+?`、`{n,m}?` | 尽量少  | ✅ 可回溯 | 避免过度吞噬      |
| 占有  | `*+`、`++`、`{n,m}+` | 尽量多  | ❌ 不回溯 | 优化性能、防止灾难回溯 |


📘 **机制说明**：

- 贪婪：匹配尽量多，如失败则回溯减少；
- 占有：匹配尽量多，但**不允许**回溯；
- 惰性：匹配尽量少，如失败则回溯增加。


注意点

| 正则    | 说明                                                       |
| :---- | -------------------------------------------------------- |
| .*    | 它可以匹配空字符，也就是可以不匹配任何字符                                    |
| 位置替换  | 匹配位置（锚点）是可以替换的，如 正则：`/(a)?/k/g` ，字符串：aaabbb，结果：kkkbkbkbk |


## 多选分支

|形式|说明|
|:---|:---|
| x\|y           |与 x 或 y 向匹配。例如，'z\|food' 与 "z" 或 "food" 匹配。'(z\|f)ood' 与 "zood" 或 "food" 匹配。                                                                                                                                                                                                                                                                                        |
- 多选结构的形式是`（...|...）`，在括号内以竖线`|`分隔开多个子表达式，这些子表达式也叫多选分支 ；在一个多选结构内，多选分支的数目没有限制
- 在多选结构中一般会同时使用括号（）和竖线|；但是如果没有括号（），只出现竖线|，仍然是多选结构
- **会创建回溯点**

注意 “|” 和 \[...] 都可以表示或的意思，但 | 把多个字符当成整体，而 \[...] 是单个字符

### 顺序
例：(option1|option2)，(jeff|jeffrey)用它匹配 `jeffrey`, 结果到底是 `jeff` 还是 `jeffrey` 呢
结果是 `jeff`，因为最左边的优先匹配

---

## 转义
转义使用 `\`

### 控制字符 / 字符类转义

| 转义序列 | 含义           | 说明              |
| ---- | ------------ | --------------- |
| `\t` | 制表符 Tab      | 0x09            |
| `\n` | 换行符 LF       | 0x0A            |
| `\r` | 回车符 CR       | 0x0D            |
| `\f` | 换页符 FF       | 0x0C            |
| `\v` | 垂直制表符 VT     | 0x0B            |
| `\a` | 响铃 (Bell)    | 很少支持，Perl 支持    |
| `\e` | Escape (ESC) | 常见于 Perl / PCRE |


---

### 为什么会有4个 `\`
一般在底层`写代码`时要把“字符串”转义为编译器识别的“字符串”，编译器还要把已经过1次转换的“字符串”转换为正则支持的“字符串”，再由正则引擎翻译“字符串”。
- 每一层（代码语言 → 正则引擎）都会吃掉一层 `\`

```txt
你写在代码里的 "语言"
↓（第一层翻译）
编译器看到的 "正则表达式"
↓（第二层翻译）
正则引擎理解的 “匹配规则”
```

注意：这里实际上只有在写代码时才会用到4个`\`，而用户使用的正则工具是已经经过翻译过的了。所以正则里不可能出现4个`\`只会出现在写代码时。

---

### 正则转义为纯文本
使用 `\Q...\E` 包裹的正则可以把所有正则当成普通字符
## 括号
括号有三个作用：分组、多选结构、引用分组

### 分组

| 语法                              | 名称         | 是否捕获       | 是否影响优先级        | 特点 / 用途                         |
| ------------------------------- | ---------- | ---------- | -------------- | ------------------------------- |
| `( … )`                         | **捕获分组**   | ✅          | ✅              | 最常见的分组方式，保存匹配内容到编号组 `$1`、`$2` 等 |
| `(?: … )`                       | **非捕获分组**  | ❌          | ✅              | 只用于分组，不保存匹配结果                   |
| `(?<name> … )` / `(?'name' … )` | **命名捕获分组** | ✅（命名）      | ✅              | 用 `$+{name}` / `%+` 访问，替代编号组    |
### 量词作用范围
如： (abc)?  量词`?`作用于`整个 (...)` 里的内容

### 反向引用

|形式|说明|
|:---|:---|
| \\1 - \\9      |指定一个向后引用 - 一个向后引用是上一个被匹配的子表达式的引用。引用的内容是与子表达式相匹配的内容，而不是表达式本身。一个向后引用由转义符 "\\" 加一个 "1" 到 "9" 的数字组成。"\\1" 指的是第一个子表达式，"\\2" 是第 2 个，以此类推。例如，"(a)\\1" 会捕捉 "a" 为第一个向后引用，并匹配任何 "aa" 文本。你还可以使用向后引用功能当你在 **搜索** 菜单下选择 **替换** 功能时。用正则表达式来定位一个文本格式，与之相匹配的文本能被一个指定的向后引用替换。例如，"(h)(e)" 的表达式会在文本中查找 "he"，把 "\\1" 放在 **替换为** 文本框中会用 "h" 取代 "he"， 而如果是 "\\2\\1" 的话，则会用 "eh" 取代 "he" 。 |
| \\k            |表示一个已命名的向后引用。已命名的向后引用是用以下形式引用之前匹配的已命名的捕获组：(?expression)。如果 "name" 是一个数字，则它表示一个已编号的向后引用，相当于 \\1，\\2，\\3，...。                                                                                                                                                                                                                                                         |

使用 `\1` 引用被捕获的组内容
- 注意：最大支持\9，超过要用命名分组
- 嵌套括号的引用顺序是依据开括号出现的先后顺序决定
- 非捕获分组不计数
- 也有的工具用用`$1`，根本原因是工具和编程语言的不同


### 嵌套括号

(a(b))c
**遇到第一个左括号时分配编号**（从1开始）
**采用深度优先（depth-first）+ 从左到右** 的顺序
- 也就是最内部的括号对优先级比外面的高

### 优先级
**正则表达式从左到右进行计算，并遵循优先级顺序**
 
## 锚点
锚点是匹配位置的一种。

`\A`、`\Z`、`\z` 是**定位锚点（anchors）**，但它们比常见的 `^` 和 `$` **更严格、更精确**

| 锚点   | 匹配位置                  | 是否受 `/m` 多行模式影响 | 特点                     |
| ---- | --------------------- | --------------- | ---------------------- |
| `^`  | 行首（或字符串开头）            | ✅ 是             | 可匹配每行开头（开启 `/m` 时）     |
| `$`  | 行尾（或字符串结尾，或结尾前的 `\n`） | ✅ 是             | 可匹配行尾或字符串结尾            |
| `\A` | 仅字符串开头                | ❌ 否             | **绝对开头**，不受 `/m` 影响    |
| `\Z` | 字符串结尾，或结尾前的换行符前       | ❌ 否             | **几乎等价于 `$`**，但不受 `/m` |
| `\z` | 严格的字符串结尾（最后一个字符后）     | ❌ 否             | **比 `\Z` 更严格**         |

注意：很多编辑器都是默认开启 -m（多行模式）和 -g 全局匹配的，请参见"[编辑器的默认值](#编辑器的默认值)"
<img src="/images/hangshou.jpeg" width="350">

- 记忆方式：`\z` 比`\Z` 小，应该在 `\n` 之前

## 断言/环视
也是是匹配位置的一种

### 单词边界符/数字边界符
- 如期望匹配的“单词” 包含在另一个单词之中  
- 它也能匹配数字的边界

|符号|名称|含义|等价条件 / 匹配位置|说明|
|---|---|---|---|---|
|`\b`|**单词边界 (word boundary)**|单词字符 `\w` 与 非单词字符 `\W`（或字符串起始/结尾）之间的位置|位置左边和右边**一个是 `\w`，一个不是**|零宽断言，不消耗字符|
|`\B`|**非单词边界 (non-word boundary)**|不在单词边界上|左右两边要么都为 `\w`，要么都为 `\W`|常用来反转 `\b` 的逻辑|
- 部分流派使用 `\<` 和 `\>`

### 环视
注意断言的匹配和整体匹配的关系

|类型|语法|含义|举例|示例匹配|
|---|---|---|---|---|
|**正向先行断言**|`(?=...)`|当前位置 **之后** 必须满足 `...`|`foo(?=bar)`|匹配 `"foo"`，仅当后面紧跟 `"bar"` 时|
|**负向先行断言**|`(?!...)`|当前位置 **之后** 必须 **不满足** `...`|`foo(?!bar)`|匹配 `"foo"`，仅当后面 **不是** `"bar"` 时|
|**正向后行断言**|`(?<=...)`|当前位置 **之前** 必须满足 `...`|`(?<=foo)bar`|匹配 `"bar"`，仅当前面紧跟 `"foo"` 时|
|**负向后行断言**|`(?<!...)`|当前位置 **之前** 必须 **不满足** `...`|`(?<!foo)bar`|匹配 `"bar"`，仅当前面 **不是** `"foo"` 时|

**特征**

| 特征             | 说明                                                               |
| -------------- | ---------------------------------------------------------------- |
| **零宽匹配**       | 不消耗字符，只检查位置是否合法。匹配后，指针仍在原位置。                                     |
| **可以嵌套**       | 可以在环视内部再嵌套其他环视。                                                  |
| **可以与分组、量词组合** | 但量词仅作用于环视整体，不作用于内部内容。                                            |
| **左右方向不同**     | `(?=...)` / `(?!...)` 从当前位置向右看，`(?<=...)` / `(?<!...)` 从当前位置向左看。 |
| **后行断言长度限制**   | Perl / PCRE 要求 `(?<=...)` 内的模式长度必须可确定（固定长度）。例如 `(?<=ab           |
| **性能**         | 环视属于零宽结构，但会引入大量回溯点，特别是嵌套环视时要注意性能问题。                              |

 **嵌套与优先级要点**

1. **嵌套允许**  
    如：`(?<=foo(?=bar))baz`  
    → “baz” 前必须有 “foo”，而且 “foo” 后面必须跟 “bar”。
    
2. **嵌套解析顺序**  
    环视是从外向内解析的，但匹配时按逻辑从内层条件返回结果判断外层是否成立。
    
3. **量词注意**  
    不能对环视内部模式使用无法确定长度的量词（尤其是后行断言）。
    
4. **回溯行为**  
    环视自身不消耗字符，但内部模式仍可发生回溯。  
    比如：(?=a.*b) 内部会对 .* 部分产生回溯点。 `*`

---


## Unicode
在 Unicode 下`.`不等于“一个字符”
等等...内容这里不再写

## 修饰符
在正则尾的也叫`匹配模式`，另一个在正则内的叫`内联修饰符`

### 匹配模式

两种修饰符，
- 一种是形如：/foo/bar/igm
- 一种是形如：/(?igm)foo/bar/ 
### 内联修饰符
**即正则内控制模式的修饰符**

| 写法         | 位置       | 作用范围        | 示例                           |
| ---------- | -------- | ----------- | ---------------------------- |
| `(?i)`     | 出现在正则最前面 | 全局（整个表达式）   | `(?i)abc` 匹配 `ABC`、`abc` 等   |
| `(?i:...)` | 在括号内带冒号  | 局部（只影响括号内部） | `(?i:abc)d` 中只有 `abc` 大小写不敏感 |
| `(?-i)`    | 取消修饰符    | 可以全局或局部     | `(?-i:abc)` 强制区分大小写          |
✅ 修饰符作用于“当前组及其子组”（嵌套括号也一样）。作用的范围不同。

---


| 修饰符 | 功能                          | 是否可局部 | 说明                     |
| :-- | :-------------------------- | :---- | :--------------------- |
| `i` | 忽略大小写                       | ✅     | `(?i)` 或 `(?i:abc)`    |
| `g` | 全局匹配                        | ✅     | 从上一次匹配的结尾继续匹配          |
| `m` | 多行模式，`^` 和 `$` 匹配行首行尾       | ✅     | 影响锚点匹配行为               |
| `s` | 单行模式，让所有字符连成单行。让 `.` 匹配换行符。 | ✅     | 默认 `.` 不匹配 `\n`        |
| `x` | 忽略空白并允许 `#` 注释              | ✅     | 方便可读性（可多行）             |
| `U` | 反转量词默认行为（非贪婪）               | ✅     | `*` 默认变懒惰              |
| `d` | `$` 仅匹配文本末尾（不匹配换行前）         | ✅     | 控制 `$` 行为              |
| `J` | 允许重复命名捕获组                   | ✅     | 否则重复命名报错               |
| `n` | 禁用所有捕获组（隐含为非捕获）             | ✅     | 等价于每个 `( )` 都是 `(?: )` |
| `u` | 启用 Unicode 模式（UTF 匹配）       | ✅     | 在 UTF 模式下默认开启          |
| `D` | `$` 不匹配行尾前的换行符              | ✅     | 与 `d` 等价（别名）           |
- 单行模式影响的是`.`的匹配规则
- 多行模式影响的是`^`和 `$` 的匹配规则

---

| 写法                   | 含义                            | 作用范围        |
| :------------------- | :---------------------------- | :---------- |
| `(?i)`               | 设置全局忽略大小写                     | 从当前位置到表达式末尾 |
| `(?i:abc)`           | 局部忽略大小写                       | 仅 `abc`     |
| `(?-i)`              | 关闭忽略大小写                       | 从当前位置起关闭    |
| `(?im)`              | 同时启用多个修饰符                     | 叠加效果        |
| `(?i-mx)`            | 启用 `i`，关闭 `m`、`x`             | 可混用正负       |
| `(?i:foo)(?v-i:bar)` | 局部切换先忽略大小写匹配 foo 再关闭大小写匹配 bar | 不同子模式独立控制   |
- 注意内联修饰符和反向引用的作用范围
## 回溯
用面包屑比喻就很好理解—如果前面是死路，你只需要沿原路返回，直到找到一堆面包屑为止。

回溯的原则：
先选择哪个分支？
- 贪婪模式尽可能多地匹配，遇到需要回退就回退，非贪婪模式就相反的。
先回溯到哪个分支？
- 就近原则

用面包屑比喻就很好理解—如果前面是死路，你只需要沿原路返回，直到找到一堆面包屑为止

具体流程请参考:[正则匹配流程](#正则匹配过程)

